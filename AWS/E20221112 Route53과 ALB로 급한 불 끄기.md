
## Route53과 ALB로 급한 불 끄기

급하게 어떤 도메인을 포워딩 시켜야할 일이 있었다. 한 도메인의 특정 레코드 하위 루트들을 모두 다른 곳으로 포워딩 또는 리다이렉트 시켜야 한다는 요청이었다.    

Route53으로 생성된 도메인이라 문제의 도메인의 레코드를 찾았고, 라우팅을 할 수 있는 두가지 방법을 떠올렸다. 하나는 해당 레코드의 방향을 Lambda로 목적지를 가리키는 CloudFront로 바꿔주는 방법, 다른 하나는 목적지로 리다이렉션하는 LB로 하는 것이었다.

## Route53

Route53은 도메인 저장소이다. 참고로 53은 DNS에서 전통적으로 사용되는 port 번호라고 한다.

자주 사용되는 레코드의 종류이다.
```
A : 호스트명을 Ip4에 연결
AAAA : 호스트명을 Ip6에 연결
CNAME : 호스트를 다른 호스트에 연결
NameServer : 호스팅 존에 대한 Name server
TXT : 텍스트 저장, 주로 메모용 
```

## Cloud Front 
AWS의 CDN 서비스이다. Origin Domain, 배포 도메인, Cache 설정, 유저의 접근 (HTTP method, HTTPS, 접근 리전 등) 을 설정한다. 이를 이용해서 Lambda를 배포할 수 도 있는데, Lambda로 변경하고자 하는 도메인을 설정/배포한 CloudFront를 Route53의 문제 도메인의 레코드에 연결한다는 계획이었다.    

사실 CDN을 사용하여 거리를 가깝게할 필요가 있어 이 방식이 정답일 것 같지만 일단 임시로 해두는 응답이 빠르지 않아도 되는 도메인이고, 배포하는데 시간이 많이 들어 일단 이 방법을 사용하지 않았다.

## Load balancer

Load blancer의 리다이렉션을 이용하여 풀이해 보았다. 만든 LB의 리스너 규칙으로 요청에 따른 리다이렉션 규칙을 한번에 볼 수 있다.

<img width="927" alt="image" src="https://user-images.githubusercontent.com/46060746/201454464-7c7dff45-6902-4216-a189-c5f7d70bedf3.png">

 Http, Https로 들어온 각각의 요청을 하위 path와 query param을 그대로 하여 목적 url에 리다이렉트한다고 읽으면 된다.   

## 포워딩과 리다이렉트의 차이

이 둘은 주체가 다르다. 포워딩은 서버 내에서 A -> B로 핸들러를 변경하여 응답하는 것을 말하고, 리다이렉트는 300번대 HttpStatus로 응답하고 이를 읽은 브라우저가 다시 해당 경로에 요청을 보내게 된다.    
